<controls:ComponentBase
    x:Class="PyExecutor.Settings.PythonComponentSettingsControl"
    x:TypeArguments="settings:PythonComponentSettings"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ci="http://classisland.tech/schemas/xaml/core"
    xmlns:controls="clr-namespace:ClassIsland.Core.Abstractions.Controls;assembly=ClassIsland.Core"
    xmlns:settings="clr-namespace:PyExecutor.Settings"
    xmlns:local="clr-namespace:PyExecutor.Settings"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignWidth="640"
    d:DesignHeight="480">
    <ScrollViewer>
        <StackPanel
            Style="{StaticResource SettingsPageStackPanelStyle}"
            DataContext="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=local:PythonComponentSettingsControl}}">

            <ci:SettingsCard IconGlyph="Console"
                             Header="Python 解释器"
                             Description="留空时使用系统 PATH 中的 python。">
                <ci:SettingsCard.Switcher>
                    <StackPanel Margin="10 4 0 0">
                        <TextBox Text="{Binding Settings.PythonExecutable, UpdateSourceTrigger=PropertyChanged}"
                                 MinWidth="320"
                                 ToolTip="例如：C:\Python312\python.exe" />
                        <TextBlock Text="示例：C:\Python312\python.exe"
                                   Margin="0 4 0 0"
                                   Foreground="{DynamicResource MaterialDesignBodySecondary}" />
                    </StackPanel>
                </ci:SettingsCard.Switcher>
            </ci:SettingsCard>

            <ci:SettingsCard IconGlyph="CodeBraces"
                             Header="Python 脚本"
                             Description="编写包含 main() 函数的脚本，返回值将显示在组件中。">
                <ci:SettingsCard.Switcher>
                    <Grid Margin="10 4 0 0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Button Content="测试脚本"
                                HorizontalAlignment="Left"
                                Click="RunNowButton_OnClick" />

                        <Border Grid.Row="1"
                                Margin="0 6 0 4"
                                BorderThickness="1"
                                CornerRadius="4"
                                BorderBrush="{DynamicResource MaterialDesignDivider}">
                            <TextBox AcceptsReturn="True"
                                     AcceptsTab="True"
                                     VerticalScrollBarVisibility="Auto"
                                     HorizontalScrollBarVisibility="Auto"
                                     FontFamily="Consolas"
                                     TextWrapping="NoWrap"
                                     Padding="4"
                                     Text="{Binding Settings.Script, UpdateSourceTrigger=PropertyChanged}" />
                        </Border>

                        <TextBlock Grid.Row="2"
                                   Foreground="{DynamicResource MaterialDesignBodySecondary}"
                                   Text="{Binding TestStatus}" />
                    </Grid>
                </ci:SettingsCard.Switcher>
            </ci:SettingsCard>

            <ci:SettingsCard IconGlyph="TimerOutline"
                             Header="刷新频率"
                             Description="控制是否定时执行脚本以及刷新间隔。">
                <ci:SettingsCard.Switcher>
                    <StackPanel Margin="10 4 0 0">
                        <CheckBox Content="启用定时刷新"
                                  IsChecked="{Binding Settings.AutoRefreshEnabled}"
                                  Margin="0 0 0 6" />
                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <TextBlock Text="间隔（秒）：" VerticalAlignment="Center" />
                            <TextBox Width="80"
                                     Margin="6 0 0 0"
                                     HorizontalContentAlignment="Center"
                                     Text="{Binding Settings.RefreshIntervalSeconds, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>
                        <TextBlock Text="最小 1 秒，设置为 0 或负数将回退为默认 5 秒。"
                                   Margin="0 4 0 0"
                                   Foreground="{DynamicResource MaterialDesignBodySecondary}" />
                    </StackPanel>
                </ci:SettingsCard.Switcher>
            </ci:SettingsCard>

        </StackPanel>
    </ScrollViewer>
</controls:ComponentBase>
